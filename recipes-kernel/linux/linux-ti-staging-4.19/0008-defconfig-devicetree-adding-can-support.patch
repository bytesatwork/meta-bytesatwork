From 20af80013dbbdd0d3511aa4348dea5f19dd41dd1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Stephan=20D=C3=BCnner?= <stephan.duenner@bytesatwork.ch>
Date: Fri, 1 Apr 2016 07:50:30 +0200
Subject: [PATCH] defconfig/devicetree: adding can support

Signed-off-by: Daniel Ammann <daniel.ammann@bytesatwork.ch>
---
 arch/arm/boot/dts/bytepanel.dtsi     | 15 ++++++++++++++
 arch/arm/configs/bytepanel_defconfig | 40 +++++++++++++++++++++++++++++++++++-
 2 files changed, 54 insertions(+), 1 deletion(-)

diff --git a/arch/arm/boot/dts/bytepanel.dtsi b/arch/arm/boot/dts/bytepanel.dtsi
index a171ce147553..9a40cb58d4e9 100644
--- a/arch/arm/boot/dts/bytepanel.dtsi
+++ b/arch/arm/boot/dts/bytepanel.dtsi
@@ -146,6 +146,14 @@
 			PIN_MCASP0_ACLKR	(MUX_MODE7 | PIN_OUTPUT_PULLDOWN)	// GPIOMUX3
 		>;
 	};
+
+	// -----DCAN1 on X6 -----
+	dcan1_pins: pinmux_dcan1_pins {
+		pinctrl-single,pins = <
+			PIN_UART1_RXD		(MUX_MODE2 | PIN_OUTPUT)	// (dcan1_tx)
+			PIN_UART1_TXD		(MUX_MODE2 | PIN_INPUT)		// (dcan1_rx)
+		>;
+	};
 };
 
 // ---- UART0 on X3 ----
@@ -155,6 +163,13 @@
 	status = "okay";
 };
 
+// -----DCAN1 on X6 -----
+&dcan1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&dcan1_pins>;
+	status = "disabled";
+};
+
 // ---- UART1 on X6 ----
 &uart1 {
 	pinctrl-names = "default";
diff --git a/arch/arm/configs/bytepanel_defconfig b/arch/arm/configs/bytepanel_defconfig
index ba00651b3978..4c6731e2a52a 100644
--- a/arch/arm/configs/bytepanel_defconfig
+++ b/arch/arm/configs/bytepanel_defconfig
@@ -807,7 +807,45 @@ CONFIG_BQL=y
 # CONFIG_NET_TCPPROBE is not set
 # CONFIG_NET_DROP_MONITOR is not set
 # CONFIG_HAMRADIO is not set
-# CONFIG_CAN is not set
+CONFIG_CAN=y
+CONFIG_CAN_RAW=y
+CONFIG_CAN_BCM=y
+CONFIG_CAN_GW=y
+
+#
+# CAN Device Drivers
+#
+# CONFIG_CAN_VCAN is not set
+# CONFIG_CAN_SLCAN is not set
+CONFIG_CAN_DEV=y
+CONFIG_CAN_CALC_BITTIMING=y
+# CONFIG_CAN_LEDS is not set
+# CONFIG_CAN_TI_HECC is not set
+# CONFIG_CAN_FLEXCAN is not set
+# CONFIG_CAN_GRCAN is not set
+# CONFIG_CAN_RCAR is not set
+# CONFIG_CAN_SJA1000 is not set
+CONFIG_CAN_C_CAN=y
+CONFIG_CAN_C_CAN_PLATFORM=y
+# CONFIG_CAN_M_CAN is not set
+# CONFIG_CAN_CC770 is not set
+
+#
+# CAN SPI interfaces
+#
+# CONFIG_CAN_MCP251X is not set
+
+#
+# CAN USB interfaces
+#
+# CONFIG_CAN_EMS_USB is not set
+# CONFIG_CAN_ESD_USB2 is not set
+# CONFIG_CAN_GS_USB is not set
+# CONFIG_CAN_KVASER_USB is not set
+# CONFIG_CAN_PEAK_USB is not set
+# CONFIG_CAN_8DEV_USB is not set
+# CONFIG_CAN_SOFTING is not set
+# CONFIG_CAN_DEBUG_DEVICES is not set
 # CONFIG_IRDA is not set
 # CONFIG_BT is not set
 # CONFIG_AF_RXRPC is not set
-- 
2.11.0

