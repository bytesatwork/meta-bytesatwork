From e06eb573c7a3dca9a9d471bd368697572a438cde Mon Sep 17 00:00:00 2001
From: Daniel Ammann <daniel.ammann@bytesatwork.ch>
Date: Thu, 17 Nov 2016 16:47:26 +0100
Subject: [PATCH 15/15] m2config: change ram detection order: first try eeprom,
 then use fallback

---
 board/bytesatwork/am335x/m2config/m2config_get.c | 4 ++--
 board/bytesatwork/am335x/ram.c                   | 4 +++-
 2 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/board/bytesatwork/am335x/m2config/m2config_get.c b/board/bytesatwork/am335x/m2config/m2config_get.c
index ef7515d..2907a19 100644
--- a/board/bytesatwork/am335x/m2config/m2config_get.c
+++ b/board/bytesatwork/am335x/m2config/m2config_get.c
@@ -12,10 +12,10 @@
 
 int m2config_get(struct m2config *config)
 {
-	if (m2config_builtin(config) == 0)
+	if (m2config_eeprom_read(config) == 0)
 		return 0;
 
-	if (m2config_eeprom_read(config) == 0)
+	if (m2config_builtin(config) == 0)
 		return 0;
 
 	return -1;
diff --git a/board/bytesatwork/am335x/ram.c b/board/bytesatwork/am335x/ram.c
index 1550a54..6da3a60 100644
--- a/board/bytesatwork/am335x/ram.c
+++ b/board/bytesatwork/am335x/ram.c
@@ -270,8 +270,10 @@ static const struct ram_config *getRam(void)
 	if (m2config_get(&config) == 0)
 		ram = findRam(config.ram);
 
-	if (ram == NULL)
+	if (ram == NULL) {
 		ram = &ram_init_map[1]; /* set default to legacy DDR3 */
+		printf("Error: no RAM configuration found, trying fallback configuration %u\n", ram->config);
+	}
 
 	return ram;
 }
-- 
2.1.4

